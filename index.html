<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬ - Ù…Ù‡Ø§Ø±Ø§Øª Ø±Ù‚Ù…ÙŠØ©</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Tajawal", sans-serif;
        background-color: #f8fafc;
      }
      .loader {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #1e3a8a;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .hidden {
        display: none;
      }
      @media print {
        .no-print {
          display: none !important;
        }
        body {
          background: white;
          -webkit-print-color-adjust: exact;
        }
        .print-container {
          box-shadow: none;
          max-width: 100%;
          width: 100%;
          margin: 0;
          padding: 0;
        }
      }
    </style>
  </head>
  <body class="min-h-screen py-8 px-4">
    <script>
      // ==========================================
      // ğŸ”´ Ù‡Ø§Ù…: Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
      // ==========================================
      const API_URL =
        "https://script.google.com/macros/s/AKfycbxjjNWLq0R9Te2-Gv-bKgjf-Of1KhAcTPzSiGECDsKmiJ3ZsUBdacbrxAz2tFMTUp0O/exec";
    </script>

    <div
      id="searchBox"
      class="max-w-md mx-auto bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100 no-print transition-all duration-300"
    >
      <div class="bg-blue-900 p-6 text-center">
        <img
          src="https://sites.moe.gov.sa/assets/images/default-img.jpg"
          class="h-20 mx-auto mb-3 bg-white rounded-full p-1"
        />
 <h2 class="text-white text-xl font-bold">
          ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø§Ø¯Ø©/ Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©
        </h2>
        <p class="text-blue-200 text-sm">
          "Ø³Ø¬Ù„ Ù…ØªØ§Ø¨Ø¹Ø© Ù„ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± ÙŠØ­Ø¯Ø« Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§"
        </p>
        <p class="text-blue-200 text-sm">Ù…Ø¯Ø±Ø³Ø© ØºØ±Ù†Ø§Ø·Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©</p>
        <p class="text-blue-200 text-sm">Ø§Ù„Ù…Ø¹Ù„Ù… / Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨Ù† Ø±Ø´ÙŠØ¯ Ø§Ù„Ø¯Ø±ÙŠØ¨ÙŠ</p>
      </div>
      <div class="p-8">
        <label class="block text-gray-700 text-sm font-bold mb-2"
          >Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© Ø§Ù„Ø·Ø§Ù„Ø¨:</label
        >
        <input
          type="text"
          id="idInput"
          class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-lg rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-3 text-center"
          placeholder="S123456789"
          onkeypress="if (event.keyCode == 13) getResult();"
        />

        <button
          onclick="getResult()"
          id="searchBtn"
          class="w-full mt-6 text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-lg px-5 py-3 text-center flex justify-center items-center gap-2 shadow-lg transition-transform transform active:scale-95"
        >
          Ø¨Ø­Ø«
        </button>
        <p
          id="msg"
          class="mt-4 text-center text-red-600 text-sm font-bold hidden"
        ></p>
      </div>
    </div>

    <div
      id="reportBox"
      class="hidden max-w-[210mm] mx-auto bg-white shadow-2xl min-h-[297mm] p-10 relative print-container rounded-lg mt-4"
    >
      <div class="flex justify-end gap-2 mb-6 no-print">
        <button
          onclick="window.print()"
          class="bg-gray-800 hover:bg-gray-900 text-white px-4 py-2 rounded text-sm flex items-center gap-2"
        >
          ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©
        </button>
        <button
          onclick="location.reload()"
          class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm"
        >
          Ø¨Ø­Ø« Ø¬Ø¯ÙŠØ¯
        </button>
      </div>

      <div
        class="flex justify-between items-center border-b-4 border-double border-blue-900 pb-4 mb-6"
      >
        <div
          class="text-center w-1/3 text-sm font-bold text-gray-800 leading-6"
        >
          <p>ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…</p>
          <p>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø¨Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±ÙŠØ§Ø¶</p>
          <p>Ù…Ø¯Ø±Ø³Ø© ØºØ±Ù†Ø§Ø·Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©</p>
        </div>

        <div class="text-center w-1/3">
          <img
            src="https://moe.gov.sa/Style%20Library/Images/v2030_LightColors.svg"
            class="h-24 object-contain mx-auto"
          />
        </div>

        <div
          class="text-center w-1/3 text-sm font-bold text-gray-800 leading-6"
        >
          <p>Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„</p>
          <p>Ø§Ù„Ù…Ø§Ø¯Ø©: Ù…Ù‡Ø§Ø±Ø§Øª Ø±Ù‚Ù…ÙŠØ©</p>
          <p class="text-xs text-gray-500 mt-1">
            ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: <span id="pDate"></span>
          </p>
        </div>
      </div>

      <div class="bg-blue-50 border border-blue-100 rounded-xl p-5 mb-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="flex items-center gap-3">
            <div class="bg-blue-200 p-2 rounded-full text-blue-800">
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                ></path>
              </svg>
            </div>
            <div>
              <p class="text-xs text-gray-500">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</p>
              <p class="font-bold text-gray-900 text-lg" id="d_name">--</p>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <div class="bg-blue-200 p-2 rounded-full text-blue-800">
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2"
                ></path>
              </svg>
            </div>
            <div>
              <p class="text-xs text-gray-500">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</p>
              <p class="font-bold text-gray-900 text-lg" id="d_id">--</p>
            </div>
          </div>
        </div>
        <div
          class="mt-4 pt-4 border-t border-blue-200 flex justify-between text-sm"
        >
          <span>Ø§Ù„ØµÙ: <b id="d_grade">--</b></span>
          <span>Ø§Ù„ÙØµÙ„: <b id="d_class">--</b></span>
          <span>Ø§Ù„Ø¹Ø§Ù…: <b id="d_year">--</b></span>
        </div>
      </div>

      <h3
        class="font-bold text-gray-800 mb-4 border-r-4 border-blue-900 pr-2 text-lg"
      >
        ğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„Ø¯Ø±Ø¬Ø§Øª
      </h3>
      <div id="gradesGrid" class="grid grid-cols-2 gap-4 mb-8"></div>

      <div class="bg-blue-50 border-r-4 border-blue-600 p-4 rounded mb-4">
        <h4 class="font-bold text-gray-800 mb-1 flex items-center gap-2">
          <span>ğŸ“</span> Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© ÙˆØ§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø¯Ø§Ø¦ÙŠØ©:
        </h4>
        <p class="text-gray-700 text-sm leading-relaxed" id="d_homework">...</p>
      </div>

      <div class="bg-yellow-50 border-r-4 border-yellow-400 p-4 rounded mb-10">
        <h4 class="font-bold text-gray-800 mb-1 flex items-center gap-2">
          <span>ğŸ’¡</span> Ù…Ù„Ø­ÙˆØ¸Ø§Øª ÙˆØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø¹Ù„Ù…:
        </h4>
        <p class="text-gray-700 text-sm leading-relaxed" id="d_notes">...</p>
      </div>

      <div class="flex justify-between items-end px-6 mt-auto pt-10">
        <div class="text-center">
          <p class="font-bold text-sm text-gray-500 mb-2">Ù…Ø¹Ù„Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</p>
          <p class="font-bold text-blue-900">Ø£. Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨Ù† Ø±Ø´ÙŠØ¯ Ø§Ù„Ø¯Ø±ÙŠØ¨ÙŠ</p>
        </div>
        <div class="text-center">
          <p class="font-bold text-sm text-gray-500 mb-2">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</p>
          <p class="font-bold text-sm text-gray-500 mb-2">ÙÙ‡Ø¯ Ø¨Ù† Ø³Ø¹Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ</p>
        </div>
    </div>

    <script>
      document.getElementById("pDate").innerText =
        new Date().toLocaleDateString("ar-SA");

      async function getResult() {
        const id = document.getElementById("idInput").value.trim();
        const btn = document.getElementById("searchBtn");
        const msg = document.getElementById("msg");

        if (!id) {
          msg.innerText = "Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©";
          msg.classList.remove("hidden");
          return;
        }
        if (API_URL.includes("Ø¶Ø¹_Ø§Ù„Ø±Ø§Ø¨Ø·")) {
          alert("ØªÙ†Ø¨ÙŠÙ‡: Ù„Ù… ÙŠØªÙ… ÙˆØ¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙƒØ±Ø¨Øª ÙÙŠ Ø§Ù„ÙƒÙˆØ¯!");
          return;
        }

        // Loading state
        btn.innerHTML = '<div class="loader"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...';
        btn.disabled = true;
        msg.classList.add("hidden");

        try {
          // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„ Ù„ÙƒØ³Ø± Ø§Ù„ÙƒØ§Ø´ (t=...)
          const res = await fetch(`${API_URL}?id=${id}&t=${Date.now()}`);
          const json = await res.json();

          if (json.status === "success") {
            showData(json.data);
          } else {
            msg.innerText = json.message || "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§Ù„Ø¨";
            msg.classList.remove("hidden");
            btn.innerHTML = "Ø¨Ø­Ø«";
            btn.disabled = false;
          }
        } catch (err) {
          msg.innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰";
          msg.classList.remove("hidden");
          console.error(err);
          btn.innerHTML = "Ø¨Ø­Ø«";
          btn.disabled = false;
        }
      }

      function showData(data) {
        document.getElementById("searchBox").classList.add("hidden");
        document.getElementById("reportBox").classList.remove("hidden");

        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        document.getElementById("d_name").innerText =
          data["Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨"] || data["Ø§Ù„Ø§Ø³Ù…"] || "---";
        document.getElementById("d_id").innerText = data["Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©"] || "---";
        document.getElementById("d_grade").innerText = data["Ø§Ù„ØµÙ"] || "---";
        document.getElementById("d_class").innerText = data["Ø§Ù„ÙØµÙ„"] || "---";
        document.getElementById("d_year").innerText =
          data["Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ"] || "---";

        // Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª
        let homeworkText =
          data["Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© ÙˆØ§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø¯Ø§Ø¦ÙŠØ©"] ||
          "Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ§Ø¬Ø¨Ø§Øª Ø£Ùˆ Ù…Ù‡Ø§Ù… Ù…Ø³Ø¬Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹";
        document.getElementById("d_homework").innerText = homeworkText;

        // Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
        let notesText =
          data["Ù…Ù„Ø­ÙˆØ¸Ø§Øª ÙˆØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø¹Ù„Ù…"] ||
          data["Ù…Ù„Ø­ÙˆØ¸Ø§Øª ÙˆØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø¹Ù„Ù…:"] ||
          "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª";
        document.getElementById("d_notes").innerText = notesText;

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø³ØªØ¨Ø¹Ø§Ø¯
        const exclude = [
          "Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©",
          "Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨",
          "Ø§Ù„ØµÙ",
          "Ø§Ù„ÙØµÙ„",
          "Ø¹Ø¯Ø¯",
          "Ø§Ù„Ù…Ø§Ø¯Ø©",
          "Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ",
          "Ù…Ù„Ø­ÙˆØ¸Ø§Øª ÙˆØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø¹Ù„Ù…",
          "Ù…Ù„Ø­ÙˆØ¸Ø§Øª ÙˆØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø¹Ù„Ù…:",
          "Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© ÙˆØ§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø¯Ø§Ø¦ÙŠØ©",
        ];

        const grid = document.getElementById("gradesGrid");
        grid.innerHTML = "";

        for (let key in data) {
          if (!exclude.includes(key) && data[key] !== "") {
            let val = data[key];

            // ==========================================
            // â­ Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ø¬Ù…ØªÙŠÙ† Ø§Ù„Ù…Ø·ÙˆØ±
            // ==========================================
            let isDoubleStar = key.includes("**"); // Ù†Ø¬Ù…ØªÙŠÙ† (Ø£Ø®Ø¶Ø±)
            let isSingleStar = !isDoubleStar && key.includes("*"); // Ù†Ø¬Ù…Ø© ÙˆØ§Ø­Ø¯Ø© (Ø£Ø­Ù…Ø±)

            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø§Ø³Ù… Ù„Ù„Ø¹Ø±Ø¶
            let displayKey = key.replace(/\*\*/g, "").replace(/\*/g, "").trim();

            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³ØªØ§ÙŠÙ„
            let containerStyle = "border border-gray-200 bg-gray-50"; // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
            let titleStyle = "text-gray-500 font-bold";
            let icon = "";

            if (isDoubleStar) {
              // ğŸŸ¢ Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù†Ø¬Ù…ØªÙŠÙ† (Ø£Ø®Ø¶Ø± - ØªÙ…ÙŠØ²)
              containerStyle =
                "border-2 border-green-500 bg-green-50 shadow-md transform scale-105";
              titleStyle = "text-green-800 font-extrabold";
              icon = "ğŸŒŸ";
            } else if (isSingleStar) {
              // ğŸ”´ Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù†Ø¬Ù…Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø© (Ø£Ø­Ù…Ø± - ØªÙ†Ø¨ÙŠÙ‡)
              containerStyle =
                "border-2 border-red-500 bg-red-50 shadow-md transform scale-105";
              titleStyle = "text-red-800 font-extrabold";
              icon = "âš ï¸";
            }

            // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ù‚ÙŠÙ…
            let valColor = "text-gray-800";
            if (String(val).includes("Ù…Ù…ØªØ§Ø²")) valColor = "text-green-600";
            if (String(val).includes("Ø¶Ø¹ÙŠÙ")) valColor = "text-red-600";
            if (String(val).includes("Ù…Ù‚Ø¨ÙˆÙ„")) valColor = "text-orange-500";

            let card = `
                <div class="${containerStyle} rounded-lg p-3 flex flex-col justify-between transition-all">
                    <h5 class="text-xs ${titleStyle} mb-2 leading-relaxed flex justify-between items-center">
                        ${displayKey}
                        <span>${icon}</span>
                    </h5>
                    <p class="text-lg font-bold ${valColor} text-center">${val}</p>
                </div>
            `;
            grid.innerHTML += card;
          }
        }
      }
    </script>
  </body>
</html>
